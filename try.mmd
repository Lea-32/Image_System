graph TD
    %% 主要流程
    Start[开始] --> DataCollection[数据采集模块]
    DataCollection --> DataPreprocess[数据预处理模块]
    DataPreprocess --> DataStorage[数据存储模块]
    DataStorage --> DataAnalysis[数据分析模块]
    DataAnalysis --> DataOutput[数据输出模块]

    %% 数据采集子流程
    subgraph DataCollection[数据采集模块]
        DC1[图片数据采集] --> |格式验证| DC1_1[支持png/jpg/gif]
        DC2[文本数据采集] --> |用户输入| DC2_1[标题/描述/标签/评论]
    end

    %% 数据预处理子流程
    subgraph DataPreprocess[数据预处理模块]
        DP1[图像预处理] --> |transforms| DP1_1[尺寸标准化/增强/格式转换]
        DP2[文本预处理] --> |jieba| DP2_1[分词/关键词提取/清洗]
    end

    %% 数据存储子流程
    subgraph DataStorage[数据存储模块]
        DS1[数据库存储] --> DS1_1[SQL Server]
        DS1_1 --> |表结构| DS2[Image表]
        DS1_1 --> |表结构| DS3[Users表]
        DS1_1 --> |表结构| DS4[Tag表]
        DS1_1 --> |表结构| DS5[Comment表]
        DS1_1 --> |表结构| DS6[Favorite表]
    end

    %% 数据分析子流程
    subgraph DataAnalysis[数据分析模块]
        DA1[图像分析] --> |深度学习| DA1_1[EfficientNet/ResNet/ViT]
        DA2[文本分析] --> |NLP| DA2_1[关键词/标签分析]
    end

    %% 数据输出子流程
    subgraph DataOutput[数据输出模块]
        DO1[查询输出] --> DO1_1[搜索结果/图片列表]
        DO2[统计分析] --> DO2_1[标签统计/用户分析]
    end

    %% 横向关联
    DataCollection -.-> |数据验证| Security[安全控制]
    DataPreprocess -.-> |处理验证| Security
    DataStorage -.-> |访问控制| Security
    DataAnalysis -.-> |权限验证| Security
    DataOutput -.-> |输出控制| Security

    %% 性能监控
    Performance[性能监控] -.-> DataCollection
    Performance -.-> DataPreprocess
    Performance -.-> DataStorage
    Performance -.-> DataAnalysis
    Performance -.-> DataOutput

    %% 结束流程
    DataOutput --> End[结束]

    %% 样式定义
    classDef default fill:#f9f,stroke:#333,stroke-width:2px;
    classDef module fill:#bbf,stroke:#333,stroke-width:2px;
    classDef security fill:#f66,stroke:#333,stroke-width:2px;
    classDef performance fill:#6f6,stroke:#333,stroke-width:2px;

    class DataCollection,DataPreprocess,DataStorage,DataAnalysis,DataOutput module;
    class Security security;
    class Performance performance;